---
title: Email Client Documentation
description: Setting up a mocked email account within a mail client using Mokapi.
---

# Email Client Account Configuration

## Getting Started

Before you can connect an email client to Mokapi’s mocked IMAP server, you need to
start Mokapi with a mail configuration. The following example defines both an SMTP server
for sending emails and an IMAP server for receiving them, along with two example mailboxes
you can use for testing.

```yaml title=mail.yaml
mail: '1.0'
info:
  title: Mokapi's Mail Server
servers:
  smtp:
    host: localhost:25
    protocol: smtp
  imap:
    host: localhost:143
    protocol: imap
mailboxes:
  bob@mokapi.io:
    username: bob
    password: bob123
    folders:
      Trash:
        flags: [\Trash]
  alice@mokapi.io:
    username: alice@mokapi.io
```

This configuration sets up:
- SMTP server on localhost:25 for sending mail
- IMAP server on localhost:143 for receiving mail 
- Two predefined accounts:
  - bob@mokapi.io with username `bob` and password `bob123`.
  - alice@mokapi.io with username `alice@mokapi.io` and no password required.

## 1. Access Account Setup in Your Email Client

For this guide, we will configure bob@mokapi.io as an example account.

Open your email client and navigate to the option for adding a new account. Most email clients 
have a button or menu entry labeled Add Account or New Account. When prompted, look for an option
to manually configure server settings. This step is important because automatic detection often
tries to connect to real-world email providers and may not work correctly with a mocked server.

``` box=tip
If your client offers automatic configuration, disable it so you can manually specify all server settings.
```

Example (Thunderbird):

1. Go to Account Settings → Account Actions → Add Mail Account…. 
2. Enter bob@mokapi.io as the email address. 
3. When the client attempts to find settings, select Manual config to adjust them.

## 2. Enter Account Details

Once you have reached the manual configuration screen, enter the following details for Bob’s account:


After you have entered these values, save your settings by clicking Done or Finish. Your email
client should now be able to connect to the mocked IMAP and SMTP services provided by Mokapi.

## 3. Sending a Test Email to Alice

With Bob’s account set up, you can now test sending an email to the second account, Alice.

1. Open your email client and create a new message.
2. In the To field, enter alice@mokapi.io.
3. Write a subject line and add any message text you like.
4. Click Send to deliver the message.

Behind the scenes, your client will use the SMTP server configured in Mokapi to send the message,
which will then be delivered to Alice’s mocked mailbox. You can verify this by opening the Mokapi
dashboard, where the message should appear. If you also configure Alice’s account in your email
client, you can switch to her inbox and see the message arrive instantly.

## 4. Using SSL/TLS

Mokapi supports secure connections using both implicit SSL/TLS (for example, IMAPS on port 993)
and explicit StartTLS (where a plain connection is upgraded to secure). When a secure connection
is used, Mokapi automatically generates a certificate for the hostname defined in the server
configuration. These certificates are signed by Mokapi’s own Root CA, which you can
[download here](https://github.com/marle3003/mokapi/tree/main/assets).

However, depending on your setup and the email client you are using, you may encounter some issues:

- If you connect using the hostname localhost, Apple Mail will not trust the certificate. 
- Connecting on non-standard secure ports can also trigger warnings. 
- If the Root CA is not trusted by your operating system, the client will display certificate errors. 
- In Apple Mail, changing security settings on an existing account does not trigger a trust dialog; you may need to recreate the account. 
- Mokapi's Root CA self-signs certificates generated by Mokapi unless you provide your own.

### Solutions

#### 1. Trust Mokapi’s Root CA

Import Mokapi’s Root CA into your operating system’s trusted certificates store so the generated
certificates are accepted without warnings.

#### 2. Use Your Own Certificate

If you have your own SSL certificate, you can configure Mokapi to use it by adding it to the static 
configuration:

```yaml title=mokapi.yaml
certificates:
  static:
    - cert: ./mailCert.pem
```

### 3. Use a Custom Domain

Instead of connecting to localhost, choose a custom domain name and map it to 127.0.0.1 in your hosts file.

**macOS/Linux:**
```
sudo nano /etc/hosts
127.0.0.1   mail.mokapi.local
```

**Windows:**
```
notepad C:\Windows\System32\drivers\etc\hosts
127.0.0.1   mail.mokapi.local
```

Then update the Mokapi configuration to use the domain and the secure IMAP port:

```
servers:
  imap:
    host: mail.mokapi.local:993
    protocol: imaps
```